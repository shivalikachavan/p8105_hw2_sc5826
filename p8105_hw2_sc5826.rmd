---
title: "p8105_hw2_sc5826"
author: "Shivalika Chavan"
date: "2025-09-23"
output: github_document
---
```{r message=FALSE}
library(tidyverse)
library(haven)
library(readxl)
# order of levels for making month into a factor so the months are in chronological order, not alphabetical
month_order = c("January","February","March","April","May","June","July","August","September","October","November","December") 
```

## Problem 1
Cleaning `pols_month.csv`
```{r}
pols_month = read.csv("./data/fivethirtyeight_datasets/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate("mon", into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    month =
      recode(
        month,
        `1` = "January",
        `2` = "February",
        `3` = "March",
        `4` = "April",
        `5` = "May",
        `6` = "June",
        `7` = "July",
        `8` = "August",
        `9` = "September",
        `10` = "October",
        `11` = "November",
        `12` = "December"
        ),
    month = factor(month, levels = month_order), 
    president = 
      recode(
        prez_dem, # using prez_dem to create president since prez_gop has erroneous values of 2
        `0` = "gop",
        `1` = "dem"
      )
  ) |> 
  select(-day, -prez_dem, -prez_gop) |> # removing day, prez_dem, and prez_gop
  arrange(year, month) |> #arranging by year and month
  relocate(year, month, everything()) # moving year and month to front
```

Cleaning `snp.csv`. The `year` column is either `> 15` or `< 50`. I'm making the assumption that all the years `> 15` are in the 20th century (adding 1900) and all the years `< 50` are in the 21st century (adding 2000). Doing this makes the year column consistent across the `pols_month` and `snp` data frames. 
```{r}
snp = read_csv("./data/fivethirtyeight_datasets/snp.csv") |> 
  janitor::clean_names() |> 
  separate("date", into = c("month", "day", "year"), sep = "/", convert = TRUE) |> 
  mutate(
    month =
      recode(
        month,
        `1` = "January",
        `2` = "February",
        `3` = "March",
        `4` = "April",
        `5` = "May",
        `6` = "June",
        `7` = "July",
        `8` = "August",
        `9` = "September",
        `10` = "October",
        `11` = "November",
        `12` = "December"
        ),
    month = factor(month, levels = month_order),
    year = 
      case_when(
        year > 15 ~ year + 1900,
        .default = year + 2000
      )
  ) |> 
  select(-day) |> # removing day
  arrange(year, month) |> #arranging by year and month
  relocate(year, month, everything()) # moving year and month to front
```

Cleaning `unemployment.csv`.
```{r}
unemployment = read_csv("./data/fivethirtyeight_datasets/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment_pct"
  ) |> 
  mutate(
    month =
      recode(
        month,
        `jan` = "January",
        `feb` = "February",
        `mar` = "March",
        `apr` = "April",
        `may` = "May",
        `jun` = "June",
        `jul` = "July",
        `aug` = "August",
        `sep` = "September",
        `oct` = "October",
        `nov` = "November",
        `dec` = "December"
        ),
    month = factor(month, levels = month_order),
  ) |> 
  arrange(year, month) |> #arranging by year and month
  relocate(year, month, everything()) # moving year and month to front
```
First merging `snp` into `pols_month`, then `unemployment` into the result using left_joins. This keeps all the observations in `pols_month`, since it includes some months and years during which there is no data recorded in `snp` or `unemployment.` 
```{r}
pols_snp_unemployment_df = left_join(pols_month, snp, by = c("year", "month")) |> 
  left_join(unemployment, by = c("year", "month"))
```

The cleaned `pols_month` data set has `r nrow(pols_month)` observations and `r ncol(pols_month)` variables (`r colnames(pols_month)`), ranging from `r min(pull(pols_month, year))` to `r max(pull(pols_month, year))`. The cleaned `snp` data set has `r nrow(snp)` observations and `r ncol(snp)` variables (`r colnames(snp)`), ranging from `r min(pull(snp, year))` to `r max(pull(snp, year))`. The cleaned `unemployment` data set has `r nrow(unemployment)` observations and `r ncol(unemployment)` variables (`r colnames(unemployment)`), ranging from `r min(pull(unemployment, year))` to `r max(pull(unemployment, year))`. 

The resulting data set, `pols_snp_unemployment_df`, has `r nrow(pols_snp_unemployment_df)` observations and `r ncol(pols_snp_unemployment_df)` variables (`r colnames(pols_snp_unemployment_df)`), ranging from `r min(pull(pols_snp_unemployment_df, year))` to `r max(pull(pols_snp_unemployment_df, year))`. This data set contains information about the # of GOP and Democrat governors, senators, representatives (congresspeople), the political party of the president, the closing value of the S&P stock index, and unemployment percentage for each month from `r min(pull(pols_snp_unemployment_df, year))` to `r max(pull(pols_snp_unemployment_df, year))`. Some data about the S&P stock index closing and unemployment percentage was not collected for older months, and is marked as `NA` in these cases. 




## Problem 2
Reading and cleaning the `Mr. Trash Wheel` data set. Since the given month is not a factor, I'm using the same recoding pipeline as Problem 1, using `date` as the ground truth and getting rid of the original month and year variables. I'm also excluding the last row (row 655 in the original Excel sheet), which contains the sum of each column. These values can always be recalculated using the R data frame. 
```{r}
mr_trash_wheel_data = 
  read_excel("./data/202409_Trash_Wheel_Collection_Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N653") |> 
  janitor::clean_names() |> 
  select(-month, -year) |> 
  separate("date", into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    month =
      recode(
        month,
        `1` = "January",
        `2` = "February",
        `3` = "March",
        `4` = "April",
        `5` = "May",
        `6` = "June",
        `7` = "July",
        `8` = "August",
        `9` = "September",
        `10` = "October",
        `11` = "November",
        `12` = "December"
        ),
    month = factor(month, levels = month_order),
    sports_balls = as.integer(round(sports_balls, digits = 0)),
    trash_wheel = "Mr. Trash Wheel"
  )|> 
  relocate(glass_bottles, sports_balls, .after = "trash_wheel")
```

Reading and cleaning the `Professor Trash Wheel` data set. Same justifications for getting rid of original month and year columns and row 123 which has sums. 
```{r}
prof_trash_wheel_data = 
  read_excel("./data/202409_Trash_Wheel_Collection_Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M120") |> 
  janitor::clean_names() |> 
  select(-month, -year) |> 
  separate("date", into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    month =
      recode(
        month,
        `1` = "January",
        `2` = "February",
        `3` = "March",
        `4` = "April",
        `5` = "May",
        `6` = "June",
        `7` = "July",
        `8` = "August",
        `9` = "September",
        `10` = "October",
        `11` = "November",
        `12` = "December"
        ),
    month = factor(month, levels = month_order),
    trash_wheel = "Professor Trash Wheel"
  ) |> 
  relocate(glass_bottles, .after = "trash_wheel")
```

Reading and cleaning the `Gwynnda Trash Wheel` data set. Same justifications for getting rid of original month and year columns and row 266 which has sums. 
```{r}
gwynnda_trash_wheel_data = 
  read_excel("./data/202409_Trash_Wheel_Collection_Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:L265") |> 
  janitor::clean_names() |> 
  select(-month, -year) |> 
  separate("date", into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    month =
      recode(
        month,
        `1` = "January",
        `2` = "February",
        `3` = "March",
        `4` = "April",
        `5` = "May",
        `6` = "June",
        `7` = "July",
        `8` = "August",
        `9` = "September",
        `10` = "October",
        `11` = "November",
        `12` = "December"
        ),
    month = factor(month, levels = month_order),
    trash_wheel = "Gwynnda Trash Wheel"
  )
```

Combining the data sets, moving the dates and `trash_wheel` name to the front of the resulting data set, arranging all observations chronological order and `trash_wheel` name. 
```{r}
trash_wheel_data = bind_rows(mr_trash_wheel_data, prof_trash_wheel_data, gwynnda_trash_wheel_data) |> 
  relocate(year, month, day, trash_wheel) |> 
  arrange(year, month, day, trash_wheel)
```

In `mr_trash_wheel_data`, there are `r nrow(mr_trash_wheel_data)` observations and `r length(unique(pull(mr_trash_wheel_data,dumpster)))` unique dumpsters. In `prof_trash_wheel_data`, there are `r nrow(prof_trash_wheel_data)` observations and `r length(unique(pull(prof_trash_wheel_data,dumpster)))` unique dumpsters. In `gwynnda_trash_wheel_data`, there are `r nrow(gwynnda_trash_wheel_data)` observations and only `r length(unique(pull(gwynnda_trash_wheel_data,dumpster)))` unique dumpsters. This is unlike the other 2 datasets, which have 1 observation for each dumpster. Looking closer at `gwynnda_trash_wheel_data`, dumpster 21 has `r sum(pull(gwynnda_trash_wheel_data, dumpster) == 21)` observations.


```{r echo=TRUE}
#Doing calculations here to keep the inline R code relatively clean. 
total_weight_tons_prof_trash_wheel = trash_wheel_data |> 
  filter(trash_wheel == "Professor Trash Wheel") |> 
  select(weight_tons) |> 
  sum() |> 
  as.character()

total_cigarette_butts_gwynnda = trash_wheel_data |> 
  filter(trash_wheel == "Gwynnda Trash Wheel", year == 2022, month == "June") |> 
  select(cigarette_butts) |> 
  sum() |> 
  as.character()
```


The combined data set `trash_wheel_data` has `r nrow(trash_wheel_data)` observations and `r ncol(trash_wheel_data)` variables. Each unique observation is noted by the date (`year`, `month`, and `day`), the name of the `trash_wheel` (`r unique(pull(trash_wheel_data, trash_wheel))`), and the `dumpster` number. Some observations have missing data for the remaining variables (e.g. `plastic_bottles`, `polystyrene`, `cigarette_butts`, `plastic_bags`, `wrappers`, `homes_powered`, `glass_bottles`, `sports_balls`). Professor Trash Wheel collected `r total_weight_tons_prof_trash_wheel` tons of trash in total. The original excel data omits the last 2 rows in the calculated sum of 241.26, which is why the sums are different. In June of 2022, Gwynnda collected `r total_cigarette_butts_gwynnda` cigarette butts. 






## Problem 3


